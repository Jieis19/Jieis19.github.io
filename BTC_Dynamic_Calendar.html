<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Calendar</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .event {
            background-color: lightblue;
        }
    </style>
</head>
<body>

<h2>BTC Dynamic Calendar</h2>

<div id="calendar-container">
    <button onclick="previousMonth()">Previous Month</button>
    <button onclick="nextMonth()">Next Month</button>
    <table id="calendar">
        <thead>
            <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
            </tr>
        </thead>
        <tbody id="calendar-body">
        </tbody>
    </table>
</div>

<div>
    <h3>Add Event</h3>
    <label for="event-date">Date:</label>
    <input type="date" id="event-date">
    <br>
    <label for="event-name">Event Name:</label>
    <input type="text" id="event-name">
    <br>
    <button onclick="addEvent()">Add Event</button>
</div>

<script>
    let currentDate = new Date();

    function renderCalendar() {
        const tableBody = document.getElementById("calendar-body");
        tableBody.innerHTML = "";

        const firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
        const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();

        let date = 1;
        for (let i = 0; i < 6; i++) {
            const tableRow = document.createElement("tr");
            for (let j = 0; j < 7; j++) {
                if ((i === 0 && j < firstDayOfMonth) || date > daysInMonth) {
                    const emptyCell = document.createElement("td");
                    tableRow.appendChild(emptyCell);
                } else {
                    const cell = document.createElement("td");
                    cell.textContent = date;
                    cell.dataset.date = formatDate(currentDate.getFullYear(), currentDate.getMonth() + 1, date);
                    tableRow.appendChild(cell);

                    // 恢复已存储的事件
                    const storedEvent = localStorage.getItem(cell.dataset.date);
                    if (storedEvent) {
                        const eventDiv = document.createElement("div");
                        eventDiv.innerText = storedEvent;
                        eventDiv.classList.add("event");
                        cell.appendChild(eventDiv);
                    }

                    date++;
                }
            }
            tableBody.appendChild(tableRow);
        }
    }

    function formatDate(year, month, day) {
        return year + "-" + (month < 10 ? "0" + month : month) + "-" + (day < 10 ? "0" + day : day);
    }

    function addEvent() {
        const dateInput = document.getElementById("event-date");
        const eventNameInput = document.getElementById("event-name");
        const date = dateInput.value;
        const eventName = eventNameInput.value;

        const table = document.getElementById("calendar-body");
        const cells = table.getElementsByTagName("td");
        for (const cell of cells) {
            if (cell.dataset.date === date) {
                const eventDiv = document.createElement("div");
                eventDiv.innerText = eventName;
                eventDiv.classList.add("event");
                cell.appendChild(eventDiv);

                // 将事件存储在本地存储中
                localStorage.setItem(date, eventName);
                break;
            }
        }
    }

    function previousMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    }

    function nextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    }

    // 初始化日历
    renderCalendar();
</script>

</body>
</html>
